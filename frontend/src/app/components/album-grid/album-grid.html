<!-- Loading State -->
@if (loading()) {
<div class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading albums...</p>
</div>
}

<!-- Error State -->
@if (error()) {
<div class="error-container">
    <mat-icon>error</mat-icon>
    <p>{{ error() }}</p>
    <button mat-raised-button color="primary" (click)="refreshAlbums()">Retry</button>
</div>
}

<!-- Album Grid -->
@if (!loading() && !error()) {

<!-- Back Button (when artist selected) -->
@if (selectedArtist()) {
<div class="back-button-container">
    <button mat-raised-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon> Zurück zu Künstlern
    </button>
    <h2 class="artist-title">{{ selectedArtist() }}</h2>
</div>
}

<!-- Artist Grid (when grouped and no artist selected) -->
@if (groupByArtist() && !selectedArtist()) {
<div class="grid-container">
    @for (artist of artists(); track artist) {
    <div class="grid-item artist-item" (click)="selectArtist(artist)">
        <div class="artist-card">
            <mat-icon class="artist-icon">person</mat-icon>
            <h3>{{ artist }}</h3>
        </div>
    </div>
    }
</div>
}

<!-- Album Grid (when not grouped OR artist selected) -->
@if (!groupByArtist() || selectedArtist()) {
<div class="grid-container">
    @for (album of displayedAlbums(); track album.id) {
    <div class="grid-item" [class.playing]="isPlaying(album)" [class.queued]="(getQueuePosition(album) || 0) > 1"
        [class.disabled]="startingAlbumId()" (click)="playAlbum(album)">
        <app-album-card [album]="album" [loading]="startingAlbumId() === (album.id || album.uri)"
            [queuePosition]="getQueuePosition(album)"></app-album-card>

        @if (!getQueuePosition(album)) {
        <button mat-mini-fab class="enqueue-btn" (click)="enqueueAlbum(album, $event)" [disabled]="startingAlbumId()"
            color="accent">
            <mat-icon>add</mat-icon>
        </button>
        }
    </div>
    }
</div>
}
}

<app-playback-controls [transportState]="transportState()" [hasNextAlbum]="hasNextAlbum()"
    [hasQueue]="currentQueue().length > 0" [groupByArtist]="groupByArtist" [selectedArtist]="selectedArtist">
</app-playback-controls>